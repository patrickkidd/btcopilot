# T0-2: Marriage crash on corrupt pair_bond data

**Status:** Revised
**Date:** 2026-02-21

## Problem
`Marriage.updateGeometry()` crashes with `AttributeError: 'NoneType' object has no attribute 'id'` at `marriage.py:41` when `self.people[0]` is None. This occurs when the MCP test harness injects pair_bonds with wrong field names.

## Root Cause
MCP test harness injected pair_bonds using a `people` array field (matching PDP display format) instead of the `person_a`/`person_b` fields that `PairBond` dataclass expects. `from_dict(PairBond, ...)` silently ignored the unknown `people` field, storing `person_a=None`/`person_b=None` on the server.

## Fix (approved)
MCP harness converts `people` → `person_a`/`person_b` (`inspector.py:1614-1618`). Auto-converts the `people` array field for convenience.

## Dropped (defensive reader code)
Three proposed fixes were dropped during code review per "fail early, no bandaid fixes" rule:
- `Marriage.read()` rejecting None people — defensive reader code, root cause was bad injection
- `scene.read()` filtering errored items — same rationale
- `acceptAllPDPItems`/`acceptPDPItem` guarding `self.scene is None` — low consequence, exception on click surfaces the real problem

## Validation Already Exists
`validate_pdp_deltas` already rejects pair_bonds with null `person_a`/`person_b` (lines 277-305). The crash bypassed validation because the MCP harness injects directly without validation.
