# T5-5: Add SARF editor validation

**Status:** Fix applied, tests pass, manually verified
**Date:** 2026-02-20

## Problem
The SARF editor allowed saving GT events without required `person` link or with placeholder/empty `description`, corrupting ground truth data. Validation existed only at admin approval time (`validate_extraction_for_approval()`), not at save time.

## Fix
1. **Server-side**: Added `validate_extraction_for_approval()` call in the feedback POST route (`feedback.py:create()`) for both update and create paths. Returns 400 with validation errors.
2. **Client-side**: Added `validateExtraction()` function in `discussion.js` mirroring the server validation. Integrated into `saveExtractedData()` (Alpine component save) and `saveEditedData()` (modal editor save). Shows notification on validation failure.

## Validation Rules
- Non-birth/adopted events require `person` link
- Birth/adopted events require `child` link
- All events reject placeholder or empty descriptions ("new event", "")

## Files Changed
- `btcopilot/btcopilot/training/routes/feedback.py:268-272, 312-316` — server-side validation at save time
- `btcopilot/btcopilot/training/static/js/discussion.js:4-27` — `validateExtraction()` function
- `btcopilot/btcopilot/training/static/js/discussion.js:928-932` — validation in `saveExtractedData()`
- `btcopilot/btcopilot/training/static/js/discussion.js:3222-3226` — validation in `saveEditedData()`

## Tests Added
- `test_validate_rejects_event_without_person`
- `test_validate_rejects_event_with_placeholder_description`
- `test_validate_rejects_birth_without_child`
- `test_validate_accepts_valid_event`
- `test_validate_accepts_valid_birth_event`
- `test_create_extraction_rejects_invalid` (integration test)

## Verification
- All 16 feedback tests pass
- Client-side `validateExtraction()` returns correct errors in browser console
- Server returns 400 with error array for invalid extraction via curl
