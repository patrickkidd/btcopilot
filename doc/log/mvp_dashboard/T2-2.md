# T2-2: Add error handling to arrange endpoint

**Status:** Fix applied
**Date:** 2026-02-20

## Problem
The `/arrange` endpoint in `pro/routes.py:923-1032` had zero error handling. Any exception from Gemini (API failure, output truncation, JSON parse error) resulted in unstructured Flask 500.

## Fix
Added specific exception handlers:
- `OutputTruncatedError` → 413 (diagram too large)
- `json.JSONDecodeError` → 502 (invalid response from LLM)
- Other exceptions still handled by Flask's global `@app.errorhandler(Exception)` → 500

## File Changed
- `btcopilot/btcopilot/pro/routes.py:1029-1035`

## Notes
The frontend error callback (`documentcontroller.py:927`) already handles HTTP errors — it logs the status code. The fix ensures meaningful status codes reach it instead of bare 500s.
