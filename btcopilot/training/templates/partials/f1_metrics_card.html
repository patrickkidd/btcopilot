<div class="admin-section" style="margin-bottom: 2rem;">
    <div class="box">
        <div class="level">
            <div class="level-left">
                <div class="level-item">
                    <div>
                        <h2 class="title is-4">
                            <span class="icon"><i class="fas fa-chart-bar"></i></span>
                            AI Ground Truth F1 Scores
                        </h2>
                        <p class="subtitle is-6">Comparing AI extractions to {{ f1_metrics.total_statements }} approved statements across {{ f1_metrics.total_discussions }} discussions</p>
                    </div>
                </div>
            </div>
            {% if current_user and current_user.has_role(btcopilot.ROLE_ADMIN) %}
            <div class="level-right">
                <div class="level-item">
                    <div class="buttons">
                        <a href="{{ url_for('training.admin.export_ground_truth', all='true') }}" class="button is-success" download>
                            <span class="icon"><i class="fas fa-download"></i></span>
                            <span>Export All Ground Truth</span>
                        </a>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>

        {% if f1_metrics.total_statements > 0 %}
        <div class="columns is-multiline">
            <div class="column is-3">
                <div class="notification is-primary has-text-centered" style="min-height: 130px; display: flex; flex-direction: column; justify-content: center;">
                    <p class="heading">Overall F1</p>
                    <p class="title is-2">{{ "%.3f"|format(f1_metrics.aggregate_micro_f1) }}</p>
                    <p class="subtitle is-6">Aggregate Micro-F1</p>
                </div>
            </div>
            <div class="column is-3">
                <div class="notification is-info is-light has-text-centered" style="min-height: 130px; display: flex; flex-direction: column; justify-content: center;">
                    <p class="heading">People</p>
                    <p class="title is-3">{{ "%.3f"|format(f1_metrics.people_f1) }}</p>
                    <p class="subtitle is-6">Detection F1</p>
                </div>
            </div>
            <div class="column is-3">
                <div class="notification is-info is-light has-text-centered" style="min-height: 130px; display: flex; flex-direction: column; justify-content: center;">
                    <p class="heading">Events</p>
                    <p class="title is-3">{{ "%.3f"|format(f1_metrics.events_f1) }}</p>
                    <p class="subtitle is-6">Detection F1</p>
                </div>
            </div>
            <div class="column is-3">
                <div class="notification is-success is-light has-text-centered" style="min-height: 130px; display: flex; flex-direction: column; justify-content: center;">
                    <p class="heading">Exact Match</p>
                    <p class="title is-3">{{ "%.1f"|format(f1_metrics.exact_match_rate * 100) }}%</p>
                    <p class="subtitle is-6">Perfect PDPs</p>
                </div>
            </div>
        </div>

        <div class="content">
            <h4 class="title is-5">SARF Variable Coding (Macro-F1)</h4>
            <div class="columns is-multiline">
                <div class="column is-3">
                    <div class="notification is-warning is-light has-text-centered">
                        <p class="heading">Symptom</p>
                        <p class="title is-4">{{ "%.3f"|format(f1_metrics.symptom_macro_f1) }}</p>
                    </div>
                </div>
                <div class="column is-3">
                    <div class="notification is-warning is-light has-text-centered">
                        <p class="heading">Anxiety</p>
                        <p class="title is-4">{{ "%.3f"|format(f1_metrics.anxiety_macro_f1) }}</p>
                    </div>
                </div>
                <div class="column is-3">
                    <div class="notification is-warning is-light has-text-centered">
                        <p class="heading">Relationship</p>
                        <p class="title is-4">{{ "%.3f"|format(f1_metrics.relationship_macro_f1) }}</p>
                    </div>
                </div>
                <div class="column is-3">
                    <div class="notification is-warning is-light has-text-centered">
                        <p class="heading">Functioning</p>
                        <p class="title is-4">{{ "%.3f"|format(f1_metrics.functioning_macro_f1) }}</p>
                    </div>
                </div>
            </div>
        </div>

        <details>
            <summary><strong>How is this calculated?</strong></summary>
            <div class="content">
                <p class="help mt-3">
                    <strong>Matching Logic:</strong> People matched by name similarity &gt;0.8 + parent links.
                    Events matched by kind (exact) + description similarity &gt;0.5 (80% weight) + dateTime proximity (20% weight, None matches any) + link resolution.
                    SARF variables calculated via macro-F1 across matched events.
                </p>
            </div>
        </details>

        {% else %}
        <div class="notification is-warning">
            <strong>No approved ground truth yet.</strong><br>
            Approve feedback on discussion audit pages to see F1 metrics. These metrics help identify where AI extraction needs improvement.
        </div>
        {% endif %}
    </div>
</div>
